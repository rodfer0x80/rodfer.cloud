user www-data; # nobody;
worker_processes 4; # auto;
error_log logs/error.log;
pid logs/nginx.pid; # /run/nginx.pid;
worker_rlimit_nofile 8192; # ;
# include /etc/nginx/modules-enabled/*.conf;

events {
    worker_connections 4096;  # 1024;
}

http {
#         ##
#         # Basic Settings
#         ##
#         sendfile on;
#         tcp_nopush on;
#         types_hash_max_size 2048;
#         # server_tokens off;
#         # server_names_hash_bucket_size 64;
#         # server_name_in_redirect off;
#         include /etc/nginx/mime.types;
#         default_type application/octet-stream;

#         ##
#         # SSL Settings
#         ##
#         ssl_protocols TLSv1 TLSv1.1 TLSv1.2 TLSv1.3; # Dropping SSLv3, ref: POODLE
#         ssl_prefer_server_ciphers on;

#         ##
#         # Logging Settings
#         ##
#         access_log /var/log/nginx/access.log;
#         error_log /var/log/nginx/error.log;

#         ##
#         # Gzip Settings
#         ##
#         gzip on;
#         # gzip_vary on;
#         # gzip_proxied any;
#         # gzip_comp_level 6;
#         # gzip_buffers 16 8k;
#         # gzip_http_version 1.1;
#         # gzip_types text/plain text/css application/json application/javascript text/xml application/xml application/xml+rss text/javascript;

#         ##
#         # Virtual Host Configs
#         ##
#         include /etc/nginx/conf.d/*.conf;
#         include /etc/nginx/sites-enabled/*;

    # Static Content Server
    server {
        listen 80;
        listen localhost:80;
        access_log off;
        server_name rodfer.cloud www.rodfer.cloud;
        return 301 https://$server_name$request_uri;

        location / {
            root /var/www/html;
            index index.html;
        }
        
        location ~ \.(gif|jpg|png)$ {
            root /var/www/html/imgs
        }
    }

    # SSL Proxy Server
    server {
        listen 443 ssl;
        listen [::]:443 ssl;
        access_log off;
        server_name rodfer.cloud www.rodfer.cloud;

        location /public/ {
            expires max;
            add_header Pragma public;
            add_header Cache-Control "public";
        }

        location / {
            index index.html

            client_max_body_size    10m;
            client_body_buffer_size 128k;

            proxy_send_timeout   90;
            proxy_read_timeout   90;
            proxy_buffer_size    128k;
            proxy_buffers     4 256k;
            proxy_busy_buffers_size 256k;
            proxy_temp_file_write_size 256k;
            proxy_connect_timeout 30s;

            proxy_redirect  off;

            proxy_pass   http://localhost:80/;

            proxy_set_header   Host   $host;
            proxy_set_header   X-Real-IP  $remote_addr;
            proxy_set_header   X-Forwarded-For $proxy_add_x_forwarded_for;
        }

        # location /push {
        #     rewrite ^/push(.*) /$1 break;
        #     proxy_pass https://127.0.0.1:8332/push/;
        #     proxy_redirect off;
        #     proxy_set_header Host $host;
        #     proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        # }

        # cert
        # key
    }
}

#mail {
#       # See sample authentication script at:
#       # http://wiki.nginx.org/ImapAuthenticateWithApachePhpScript
#
#       # auth_http localhost/auth.php;
#       # pop3_capabilities "TOP" "USER";
#       # imap_capabilities "IMAP4rev1" "UIDPLUS";
#
#       server {
#               listen     localhost:110;
#               protocol   pop3;
#               proxy      on;
#       }
#
#       server {
#               listen     localhost:143;
#               protocol   imap;
#               proxy      on;
#       }
#}
